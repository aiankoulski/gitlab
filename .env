#!/bin/bash

# Source helper functions
source .fun

export GITLAB_HOSTNAME=localhost
export GITLAB_HTTPS_PORT=443
export GITLAB_HTTP_PORT=80
export GITLAB_SSH_PORT=2222
export GITLAB_REGISTRY_HOSTNAME=localhost
export GITLAB_REGISTRY_HTTP_PORT=5050
export GITLAB_REGISTRY_HTTPS_PORT=443
export GITLAB_CONTAINER_NAME=gitlab
export GITLAB_PATH_CONFIG=$(pwd)/wd/gitlab/config
export GITLAB_PATH_LOGS=$(pwd)/wd/gitlab/logs
export GITLAB_PATH_DATA=$(pwd)/wd/gitlab/data
export GITLAB_OMNIBUS_CONFIG="gitlab_rails['registry_enabled'] = true; gitlab_rails['registry_host'] = \"${GITLAB_REGISTRY_HOSTNAME}\"; gitlab_rails['registry_port'] = ${GITLAB_REGISTRY_HTTPS_PORT}; registry['enable'] = true; registry['registry_http_addr'] = 'localhost:5000'; registry_nginx['enable'] = true; registry_nginx['listen_port'] = ${GITLAB_REGISTRY_HTTP_PORT};"

# Proxy settings [optional] - set if your network requires a proxy to connect to the Internet
export http_proxy=""
export https_proxy=""
export no_proxy=localhost

# Docker image settings
## REGISTRY: [optional] - Docker registry path including trailing "/". Example: registry.company.com/demo/
export REGISTRY=iankoulski/
if [ -n "${REGISTRY}" ]; then
  if [ "${REGISTRY: -1}" != "/" ]; then
    export REGISTRY="${REGISTRY}/"
  fi
fi
## IMAGE: <required> - Docker image name for this project. Example: myapp
export IMAGE=gitlab
## VERSION: [optional] - Version tag for this Docker image. Example: v20180302
#export VERSION=v$(date +%Y%m%d)
export VERSION=12.5.2-ce.0
export TAG=$(if [ -z "${VERSION}" ]; then echo ""; else echo ":${VERSION}"; fi) 
## BUILD_OPTS: [optional] - arguments for the docker image build command
export BUILD_OPTS="--build-arg http_proxy=${http_proxy} --build-arg https_proxy=${https_proxy} --build-arg no_proxy=${no_proxy}"

# Docker container runtime settings
## CONTAINER_NAME: [optional] - Name of the Docker container including the --name switch. Example --name myapp
export CONTAINER=${IMAGE}
export CONTAINER_NAME="--name ${CONTAINER}"
## Port map [optional] - Mapping of external to internal ports including the -p switch. Example -p 80:8080 
export PORT_MAP="-p ${GITLAB_HTTP_PORT}:80  -p ${GITLAB_REGISTRY_HTTP_PORT}:${GITLAB_REGISTRY_HTTP_PORT} -p ${GITLAB_SSH_PORT}:22"
## Volume map [optional] - Mapping of external to internal paths including the -v switch. Example $(pwd):/wd
export VOL_MAP="-v ${GITLAB_PATH_CONFIG}:/etc/gitlab:Z -v ${GITLAB_PATH_LOGS}:/var/log/gitlab:Z -v ${GITLAB_PATH_DATA}:/var/opt/gitlab:Z"
## Network [optional] - Network name including the --net switch. Example --net mynet
export NETWORK=
## RUN_OPTS [optional] - additional options to specify with the run comman. Example -e POSTGRES_DB=dbname
export RUN_OPTS="-e http_proxy=$http_proxy -e https_proxy=$https_proxy -e no_proxy=$no_proxy"

